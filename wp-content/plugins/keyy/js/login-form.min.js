function keyy_inject_code_into_form(e,o,y){var n=jQuery,r=Keyy.get_login_token();if("undefined"==typeof y){if(keyy.is_disabled)return n(e).prepend('<div class="keyy_qrcode_container_disabled">'+keyy.disabled+"</div>"),void(Keyy.parse_query_string.hasOwnProperty("keyy_disable")&&n(e).prepend('<input type="hidden" name="keyy_disable" value="'+Keyy.parse_query_string.keyy_disable+'">'));var i='<span class="keyy-switch-text-label qr-label">'+keyy.switch_to_wave+"</span>";i+='<div class="keyy-switch keyy_wave_to_qrcode">',i+='<input type="checkbox" name="keyy-switch" class="keyy-switch-checkbox" id="keyy-switch" checked>',i+='<label class="keyy-switch-label" for="keyy-switch">',i+='<span class="keyy-switch-inner"></span>',i+='<span class="keyy-switch-toggle"></span>',i+="</label>",i+="</div>",i+='<span class="keyy-switch-text-label wave-label">'+keyy.switch_to_qr+"</span>";var t='<div class="keyy_qrcode_container"';keyy.stealth_mode&&(t+=' style="display:none;"'),t+='><img class="keyy-login-logo" src="'+keyy.keyy_logo_icon+'">',t+='<div class="keyy_qrcode" data-keyy_form_identifier="'+o+'"></div>',keyy.use_wave&&(t+='<div class="keyy_qrcode_switch">'+i+"</div>"),t+='<div> <h4 class="keyy_qrcode_wp_login_header">'+keyy.wp_form_header,t+=' / <span class="keyy_learn_more">'+keyy.login_form_learn_more+"</span></h4></div>",t+="</div>"+keyy.learn_more_template,n(e).wrapInner('<div class="default-wp-form"></div>'),n(e).prepend(t),n(e).wrapInner('<div class="keyy-login-wrapper"></div>'),n(e).find(".learn-more-slide-container").hide()}var a=n(e).find(".keyy_qrcode");if(Keyy.show_keyy_code(a,"login"),r.hasOwnProperty("origin")&&"autologin"==r.origin&&r.hasOwnProperty("password_policy")&&"required"==r.password_policy){if(r.hasOwnProperty("user_login")){var s=n("form .keyy_qrcode").first().closest("form");s.find('input[name="log"], input[name="username"], input[name="affwp_user_login"]').val(r.user_login).prop("readonly",!0),s.find(".keyy_qrcode").html(keyy.authorised_needs_password)}return void console.log("Keyy: user policy requires a password. Will not auto-submit form.")}Keyy.register_listener("login",function(e,o){if(e.hasOwnProperty("state")&&"claimed"==e.state){var y;if(y=e.hasOwnProperty("form_id")&&e.form_id?n('.keyy_qrcode[data-keyy_form_identifier="'+e.form_id+'"]').closest("form"):n("form .keyy_qrcode").first().closest("form"),y.length<1)return alert(keyy.login_form_not_found),void console.log(e);if(y.find('input[name="log"], input[name="username"], input[name="affwp_user_login"]').val(e.user_login).prop("readonly",!0),y.find('input[type="checkbox"][name="rememberme"]').prop("checked",!0),y.prepend('<input type="hidden" name="keyy_token_id" value="'+o.value+'">'),e.hasOwnProperty("password_policy")&&"required"==e.password_policy){var r=y.find('input[name="pwd"], input[name="password"], input[name="pass"]');if(r.length&&!r.val())return console.log("Keyy: user policy (user: "+e.user_login+") requires a password, and none yet entered. Will not auto-submit form."),y.find(".keyy_qrcode").html(keyy.authorised_needs_password),!0}if(console.log("Keyy: submitting: token_id="+o.value+" user_login="+e.user_login),y.find('input[type="submit"]').length>0){var i=y.find('input[type="submit"]:first'),t=i.attr("name");y.find('input[type!="submit"][name="'+t+'"]').length<1&&y.prepend('<input type="hidden" name="'+t+'" value="'+i.val()+'">')}return Keyy.exit_animation(),"wave"==Keyy.get_keyy_code_type()?setTimeout(function(){y.submit()},1200):y.submit(),!0}e.hasOwnProperty("state")&&"unused"==e.state||(console.log("Keyy: login listener responded, but not for a login:"),console.log(e))})}jQuery(document).ready(function(e){var o=0;if(e.each(keyy.hook_forms,function(y,n){var r=n.selector;e(r).length<1||(e(r).each(function(e){keyy_inject_code_into_form(this,o+1),o++}),!keyy.is_disabled&&n.hasOwnProperty("hide")&&n.hide&&e(n.hide).hide())}),e("form").on("click",".keyy_qrcode_container .keyy_wave_to_qrcode, .keyy_qrcode_container .qr-label",function(o){o.preventDefault(),Keyy.set_keyy_code_type("qr");var y=keyy.qr_url+"?context="+keyy.context+"&token="+keyy.login_token.value;e(".keyy_wave_container").each(function(){Keyy.render_keyy_code(e(this).empty(),y,Keyy.get_keyy_code_type())}),e(".keyy_wave_to_qrcode").removeClass("keyy_wave_to_qrcode").addClass("keyy_qrcode_to_wave"),e(".keyy-switch-checkbox").prop("checked",!1)}),e("form").on("click",".keyy_qrcode_container .keyy_qrcode_to_wave, .keyy_qrcode_container .wave-label",function(o){o.preventDefault(),Keyy.set_keyy_code_type("wave");var y=keyy.qr_url+"?context="+keyy.context+"&token="+keyy.login_token.value;e(".keyy_wave_container").each(function(){Keyy.render_keyy_code(e(this).empty(),y,Keyy.get_keyy_code_type())}),e(".keyy_qrcode_to_wave").removeClass("keyy_qrcode_to_wave").addClass("keyy_wave_to_qrcode"),e(".keyy-switch-checkbox").prop("checked",!0)}),e("form").on("click",".keyy_qrcode_container .keyy_learn_more",function(o){o.preventDefault(),e(this).closest(".keyy-login-wrapper").find(".learn-more-slide-container").fadeIn("slow").show(),e(this).closest(".keyy-login-wrapper").find(".keyy_qrcode_container").fadeOut("slow").hide(),e(this).closest(".keyy-login-wrapper").find(".default-wp-form").fadeOut("slow").hide(),Keyy.lazy_load_graphics(e(this).closest(".keyy-login-wrapper").find(".keyy-intro-gif"))}),e("form").on("click",".keyy-back",function(o){o.preventDefault(),e(this).closest(".keyy-login-wrapper").find(".learn-more-slide-container").fadeOut("slow").hide(),e(this).closest(".keyy-login-wrapper").find(".keyy_qrcode_container").fadeIn("slow").show(),e(this).closest(".keyy-login-wrapper").find(".default-wp-form").fadeIn("slow").show()}),keyy.stealth_mode){e("body").focus().blur();var y=function(o){if(o.hasOwnProperty("which")&&107==o.which){var n=o.target.tagName.toLowerCase();"input"!=n&&"textarea"!=n&&(e(".keyy_qrcode_container").fadeToggle("slow"),e("body").off("keypress",y))}};e("body").keypress(y)}});